function pushToast(e,t){Toastify({text:e,duration:t?Toastify.defaults.duration:1e4,style:{background:t?"green":"red"}}).showToast()}function formatDate(e){return new Date(e).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric"})}function updateAllTimes(){document.querySelectorAll(".timestamp").forEach(e=>{e.hasAttribute("corrected")||(e.innerHTML=formatDate(e.innerHTML),e.setAttribute("corrected",!0))})}function refreshPosts(){document.getElementById("refresh-posts-force").click()}document.addEventListener("postDeleted",function(){pushToast("Post deleted",!0)}),document.addEventListener("postFailedDelete",function(){pushToast("Post failed to delete, try again",!1),refreshPosts()}),document.addEventListener("timeSidebar",function(){updateAllTimes()}),document.addEventListener("accountUpdated",function(e){closeModal(document.getElementById("changeInfo")),document.getElementById("settingsData").reset();const t=document.getElementById("violationBar");t&&t.setAttribute("hidden","true"),pushToast("Settings Updated!",!0)}),document.addEventListener("accountDeleted",function(e){pushToast("Account deleted!",!0)}),document.addEventListener("refreshPosts",function(e){refreshPosts()});const domainRegex=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,linkRegex=/(?:^.*\/profile\/)([0-9a-zA-Z\-\.]+)(?:\/post\/\w+)?(?:\/)?$/g;function updateUsername(e){let t=e.replace(/[^\x00-\x7F]/g,"").replace("@","");if(t.includes("did:plc:"))return pushToast("Invalid link posted, does not have handle in it",!1),"";var n=linkRegex.exec(t);if(null!=n&&n.length>=2)return n[1];if(!t.match(domainRegex)){const e=t+".bsky.social";if(e.match(domainRegex))return e}return t}function addUsernameFieldWatchers(){const e=document.getElementById("username");null!==e&&(e.value="",e.addEventListener("change",t=>{t.preventDefault(),e.value=updateUsername(e.value)}),e.addEventListener("paste",t=>{t.preventDefault(),e.value=updateUsername(t.clipboardData.getData("text"))}))}function addCounter(e,t,n){const o=document.getElementById(e),r=document.getElementById(t);if(r){if(r.hasAttribute("counting"))return;const e=e=>{r.innerHTML=`${e.all}/${n}`,e.all>n?r.classList.add("tooLong"):r.classList.remove("tooLong")};Countable.on(o,e),r.setAttribute("counting",!0),r.addEventListener("reset",()=>{r.innerHTML=`0/${n}`,r.classList.remove("tooLong")}),r.addEventListener("recount",()=>{Countable.count(o,e)})}}function recountCounter(e){document.getElementById(e).dispatchEvent(new Event("recount"))}function resetCounter(e){document.getElementById(e).dispatchEvent(new Event("reset"))}function redirectAfterDelay(e){setTimeout(function(){window.location.href=e},1200)}function translateErrorObject(e,t){let n=t;var o=!1;try{n=JSON.parse(e.message),o=!0}catch{null!==e.message&&(n=e.message)}if(o){var r="";for(error of n)r+=`${error.message}\n`;n=r}return`Error Occurred!\n----\n${n}`}function rawSubmitHandler(e,t){const n=document.getElementById("loading");document.getElementById("loginForm").addEventListener("submit",async o=>{o.preventDefault(),n.removeAttribute("hidden");let r={};document.querySelectorAll("input").forEach(e=>{"checkbox"===e.getAttribute("type")?r[e.name]=e.checked:r[e.name]=e.value});try{const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(setTimeout(function(){n.setAttribute("hidden",!0)},1e3),o.ok)t();else{const e=await o.json();pushToast(translateErrorObject(e,e.msg),!1)}}catch(e){pushToast("An error occurred",!1),console.error(e)}})}function easySetup(e,t,n){addUsernameFieldWatchers(),rawSubmitHandler(e,function(){pushToast(t,!0),redirectAfterDelay(n)})}
