/* Tribute.js v6.2.1 license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Tribute=t()}(this,function(){"use strict";function e(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function t(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}function i(e,...t){return e.addEventListener(...t),()=>e.removeEventListener(...t)}function n(e){return"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName}function r(e){return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement}function o(e){return"object"==typeof e&&null!=e&&("jquery"in e&&void 0!==e.jquery)}var s,l;"function"==typeof SuppressedError&&SuppressedError;class a{constructor(e){s.set(this,void 0),this.tribute=e,this.mentionText="",this.externalTrigger=!1}set element(e){e&&(this.tribute.range.element=e),t(this,s,e,"f")}get element(){return e(this,s,"f")}process(e){if(null===this.tribute.menu.element||!this.collection)return;const t=this.tribute.menu.element.querySelector("ul");if(null===t)throw new Error('menu do not have "ul" element');const i=this.collection,n=t=>{if(!this.tribute.isActive)return;const n=this._filterItems(i,t);this.filteredItems=n;!0===this.tribute.menu.render(n,i)&&!0===e&&this.tribute.range.positionMenuAtCaret(e)};"function"==typeof i.values?(i.loadingItemTemplate&&(t.innerHTML=i.loadingItemTemplate,this.tribute.range.positionMenuAtCaret(e)),i.values(this.mentionText,n)):null!==i.values&&n(i.values)}updateSelection(e){this.selectedPath=e.mentionSelectedPath,this.mentionText=e.mentionText||"",this.selectedOffset=e.mentionSelectedOffset}showMenuForCollection(e,t){void 0===t||this.isMaximumItemsAdded(t,e)||(e!==document.activeElement&&this.placeCaretAtEnd(e),this.collection=t,this.externalTrigger=!0,this.element=e,e.isContentEditable?this.insertTextAtCursor(this.collection.trigger):r(e)&&this.insertAtCaret(e,this.collection.trigger))}selectItemAtIndex(e,t){const i=Number.parseInt(e,10);if(Number.isNaN(i)||!this.filteredItems||!this.collection||!this.element)return;if(null===this.collection.selectTemplate)return;const n=this.filteredItems[i],r=this.collection.selectTemplate(n,this.tribute);if(-1===i||!n){const e=new CustomEvent("tribute-selected-no-match",{detail:r});return void this.element.dispatchEvent(e)}null!==r&&this.tribute.range.replaceTriggerText(r,!0,!0,t,n)}placeCaretAtEnd(e){e.focus();const t=document.createRange();t.selectNodeContents(e),t.collapse(!1);const i=window.getSelection();null==i||i.removeAllRanges(),null==i||i.addRange(t)}insertTextAtCursor(e){const t=window.getSelection(),i=null==t?void 0:t.getRangeAt(0);if(!t||!i)return;i.deleteContents();const n=document.createTextNode(e);i.insertNode(n),i.selectNodeContents(n),i.collapse(!1),t.removeAllRanges(),t.addRange(i)}insertAtCaret(e,t){const i=e.scrollTop;let n=e.selectionStart;if(!n||!e.selectionEnd)return;const r=e.value.substring(0,n),o=e.value.substring(e.selectionEnd,e.value.length);e.value=r+t+o,n+=t.length,e.selectionStart=n,e.selectionEnd=n,e.focus(),e.scrollTop=i}get isMentionLengthUnderMinimum(){if(this.collection)return this.mentionText.length<this.collection.menuShowMinLength}_filterItems(e,t){const i=e.searchOpts,n=e.lookup,r=this.tribute.search.filter(this.mentionText,t,{pre:i.pre||"<span>",post:i.post||"</span>",skip:i.skip||!1,caseSensitive:i.caseSensitive||!1,extract:e=>{if("string"==typeof n)return e[n];if("function"==typeof n)return n(e,this.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});return e.menuItemLimit?r.slice(0,e.menuItemLimit):r}isMaximumItemsAdded(e,t){return!!(e.maxDisplayItems&&t.querySelectorAll(`[data-tribute-trigger="${e.trigger}"]`).length>=e.maxDisplayItems||e.isBlocked)}}s=new WeakMap;const c=["tab","backspace","enter","escape","space","arrowup","arrowdown"];class u{constructor(e){this.tribute=e,this.removers=[],this.inputEvent=!1,this.compositionFilter=new h}bind(e){this.removers.push(i(e,"compositionstart",e=>{this.compositionFilter.compositionstart(e)}),i(e,"compositionend",e=>{this.compositionFilter.compositionend(e)}),i(e,"keydown",e=>{this.compositionFilter.keydown(e)}),i(e,"keydown",e=>{this.keydown(e)}),i(e,"keyup",e=>{this.keyup(e)}),i(e,"input",e=>{this.compositionFilter.input(e)}),i(e,"input",e=>{this.input(e)}))}unbind(e){for(const e of this.removers)e()}keydown(e){if(!(e instanceof KeyboardEvent))return;const t=e.currentTarget;this.shouldDeactivate(e)&&(this.tribute.isActive=!1,this.tribute.hideMenu()),this.commandEvent=!1;const i=d(e.key);g(i)&&t instanceof HTMLElement&&(this.commandEvent=!0,this.callbacks[i](e,t))}input(e){e.currentTarget,this.inputEvent=!0,this.keyup(e)}keyup(e){if(!(e instanceof KeyboardEvent))return;const t=e.currentTarget;if(t instanceof HTMLElement&&(this.inputEvent&&(this.inputEvent=!1),this.updateSelection(t),e.key&&"Escape"!==e.key)){if(!this.tribute.allowSpaces&&this.tribute.hasTrailingSpace)return this.tribute.hasTrailingSpace=!1,this.commandEvent=!0,void this.callbacks.space(e,t);if(!this.tribute.isActive){const i=this.getTriggerCharCode(),n=this.tribute.range.getTrigger(i);void 0!==n&&this.triggerChar(e,t,n)}this.tribute.current.isMentionLengthUnderMinimum?this.tribute.hideMenu():((this.tribute.current.trigger||this.tribute.autocompleteMode)&&!1===this.commandEvent||this.showMenuOnBackspace(e.key))&&this.tribute.showMenuFor(t,!0)}}shouldDeactivate(e){var t;if(!this.tribute.isActive)return!1;if(!(e instanceof KeyboardEvent))return!1;if(0===(null===(t=this.tribute.current.mentionText)||void 0===t?void 0:t.length)){let t=!1;return g(d(e.key))&&(t=!0),!t}return!1}getTriggerCharCode(){const e=this.tribute,t=e.range.getTriggerInfo(!1,e.hasTrailingSpace,!0,e.allowSpaces);if(null==t?void 0:t.mentionTriggerChar)return t.mentionTriggerChar.charCodeAt(0)}updateSelection(e){this.tribute.current.element=e;const t=this.tribute.range.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces);t&&this.tribute.current.updateSelection(t)}triggerChar(e,t,i){const n=this.tribute;n.current.trigger=i;const r=n.collection.find(e=>e.trigger===i);n.current.collection=r,!n.current.isMentionLengthUnderMinimum&&this.inputEvent&&n.showMenuFor(t,!0)}get callbacks(){return this._callbacks||(this._callbacks={enter:(e,t)=>{var i;const n=this.tribute.current.filteredItems;this.tribute.isActive&&n&&n.length&&(e.preventDefault(),e.stopPropagation(),0===(null===(i=this.tribute.current.filteredItems)||void 0===i?void 0:i.length)&&this.tribute.menu.unselect(),setTimeout(()=>{this.tribute.current.selectItemAtIndex(this.tribute.menu.selected.toString(),e),this.tribute.hideMenu()},0))},escape:(e,t)=>{this.tribute.isActive&&(e.preventDefault(),e.stopPropagation(),this.tribute.isActive=!1,this.tribute.hideMenu())},tab:(e,t)=>{this.callbacks.enter(e,t)},space:(e,t)=>{this.tribute.isActive&&(this.tribute.spaceSelectsMatch?this.callbacks.enter(e,t):this.tribute.allowSpaces||(e.stopPropagation(),setTimeout(()=>{this.tribute.hideMenu(),this.tribute.isActive=!1},0)))},arrowup:(e,t)=>{if(this.tribute.isActive&&this.tribute.current.filteredItems){e.preventDefault(),e.stopPropagation();const t=this.tribute.current.filteredItems.length;this.tribute.menu.up(t)}},arrowdown:(e,t)=>{if(this.tribute.isActive&&this.tribute.current.filteredItems){e.preventDefault(),e.stopPropagation();const t=this.tribute.current.filteredItems.length;this.tribute.menu.down(t)}},backspace:(e,t)=>{this.tribute.isActive&&(this.tribute.current&&this.tribute.current.mentionText.length<1?this.tribute.hideMenu():this.tribute.showMenuFor(t))}}),this._callbacks}showMenuOnBackspace(e){const t="Backspace"===e;return(r(this.tribute.current.element)||this.tribute.isActive)&&t}}class h{constructor(){this.isComposing=!1,l.set(this,void 0)}get isFirefox(){return void 0!==e(this,l,"f")||t(this,l,window.navigator.userAgent.toLowerCase().includes("firefox"),"f"),e(this,l,"f")}compositionstart(e){this.isComposing=!0}compositionend(e){var t;e instanceof CompositionEvent&&this.isComposing&&(this.isComposing=!1,this.isFirefox||null===(t=e.target)||void 0===t||t.dispatchEvent(new InputEvent("input",{inputType:"insertText",data:e.data,isComposing:!1})))}keydown(e){e instanceof KeyboardEvent&&this.isComposing&&"Enter"===e.code&&(this.isComposing=!1)}input(e){e instanceof InputEvent&&("insertFromComposition"===e.inputType&&(this.isComposing=!1),this.isComposing&&e.stopImmediatePropagation())}}function d(e){return" "===e?"space":e.toLowerCase()}function g(e){return c.includes(e)}l=new WeakMap;class m{constructor(e){this.tribute=e,this.element=null,this.selected=0}create(e,t){const i=e.createElement("div");return this.ul=e.createElement("ul"),i.className=t,i.appendChild(this.ul),this.element=this.tribute.menuContainer?this.tribute.menuContainer.appendChild(i):e.body.appendChild(i),this.element}activate(){this.selected=0,window.setTimeout(()=>{null!==this.element&&(this.element.scrollTop=0)},0)}deactivate(){null!==this.element&&(this.element.style.cssText="display: none;",this.selected=0)}unselect(){this.selected=-1}get isActive(){return null!==this.element}get items(){return null===this.element?document.querySelectorAll(":not(*)"):this.element.querySelectorAll("li")}get itemDisabled(){var e;return"true"===(null===(e=this.items[this.selected])||void 0===e?void 0:e.getAttribute("data-disabled"))}up(e){if(null!==this.element&&-1!==this.selected){do{this.selected--,-1===this.selected&&(this.selected=e-1,this.element.scrollTop=this.element.scrollHeight)}while(this.itemDisabled);this.setActiveLi()}}down(e){if(null!==this.element&&-1!==this.selected){do{this.selected++,this.selected>=e&&(this.selected=0,this.element.scrollTop=0)}while(this.itemDisabled);this.setActiveLi()}}setActiveLi(e){if(null===this.element)return;if(!this.tribute.current.collection)return;const t=this.tribute.current.collection.selectClass;this.items.length,e&&(this.selected=e);const i=this.element;this.items.forEach((e,n)=>{if(n===this.selected){"true"!==e.getAttribute("data-disabled")&&e.classList.add(t);const n=e.getBoundingClientRect(),r=i.getBoundingClientRect();if(n.bottom>r.bottom){const e=n.bottom-r.bottom;i.scrollTop+=e}else if(n.top<r.top){const e=r.top-n.top;i.scrollTop-=e}}else e.classList.remove(t)})}positionAtCaret(e,t){null!==this.element&&(void 0!==e?this.tribute.positionMenu?(this.element.style.cssText=`top: ${t.top}px;\n                                   left: ${t.left}px;\n                                   right: ${t.right}px;\n                                   bottom: ${t.bottom}px;\n                                   max-height: ${t.maxHeight||500}px;\n                                   max-width: ${t.maxWidth||300}px;\n                                   position: ${t.position||"absolute"};\n                                   display: block;`,"auto"===t.left&&(this.element.style.left="auto"),"auto"===t.top&&(this.element.style.top="auto")):this.element.style.cssText="display: block;":this.element.style.cssText="display: none")}getDimensions(){const e={width:null,height:null};return null===this.element||(this.element.style.cssText="top: 0px;\n                                 left: 0px;\n                                 position: fixed;\n                                 display: block;\n                                 visibility; hidden;\n                                 max-height:500px;",e.width=this.element.offsetWidth,e.height=this.element.offsetHeight,this.element.style.cssText="display: none;"),e}render(e,t){return void 0!==this.ul&&(e.length?this._renderMenu(e,this.ul,t):this._handleNoItem(this.ul,t))}_handleNoItem(e,t){if(!this.element)return!1;const i=new CustomEvent("tribute-no-match",{detail:this.element});return this.element.dispatchEvent(i),("function"!=typeof t.noMatchTemplate||t.noMatchTemplate())&&t.noMatchTemplate?(e.innerHTML="function"==typeof t.noMatchTemplate?t.noMatchTemplate():t.noMatchTemplate,!0):(this.tribute.hideMenu(),!1)}_renderMenu(e,t,n){t.innerHTML="";const r=this.tribute.range.getDocument(),o=r.createDocumentFragment();return this.selected=e.findIndex(e=>!0!==e.original.disabled),this.remover&&this.remover(),this.remover=i(t,"mousemove",e=>{if(!(e.target instanceof HTMLElement))return;if(!e.target.matches("li[data-index]"))return;const t=e.target.dataset.index;"movementY"in e&&0!==e.movementY&&null!=t&&this.setActiveLi(Number.parseInt(t,10))}),e.forEach((e,t)=>{const i=this._createMenuItem(e,n,t,r);o.appendChild(i)}),t.appendChild(o),!0}_createMenuItem(e,t,i,n){const r=n.createElement("li");r.setAttribute("data-index",i.toString()),e.original.disabled&&r.setAttribute("data-disabled","true"),r.className=t.itemClass,this.selected===i&&r.classList.add(t.selectClass);const o=null!==t.menuItemTemplate?t.menuItemTemplate(e,this.tribute):"";return o instanceof Element?(r.innerHTML="",r.appendChild(o)):r.innerHTML=o,r}}class p{constructor(e){this.tribute=e,this.removers=[]}bind(e){const t=function(e,t,i=!1){let n;return function(...r){const o=i&&!n;n&&clearTimeout(n),n=setTimeout(()=>{n=null,i||e.apply(this,r)},t),o&&e.apply(this,r)}}(()=>{this.tribute.isActive&&this.tribute.hideMenu()},10,!1);this.removers.push(i(this.tribute.range.getDocument(),"mousedown",e=>this.click(e),!1)),this.removers.push(i(window,"resize",t)),!0===this.tribute.closeOnScroll?this.removers.push(i(window,"scroll",t)):!1!==this.tribute.closeOnScroll?this.removers.push(i(this.tribute.closeOnScroll,"scroll",t,!1)):this.tribute.menuContainer?this.removers.push(i(this.tribute.menuContainer,"scroll",t,!1)):this.removers.push(i(window,"scroll",t))}unbind(e){for(const e of this.removers)e()}click(e){var t,i;const n=e.target,r=this.tribute;if(r.current&&n instanceof HTMLElement)if(null===(t=r.menu.element)||void 0===t?void 0:t.contains(n)){e.preventDefault(),e.stopPropagation();const t=n.closest("li");if(!(t instanceof HTMLElement))return;if("true"===t.getAttribute("data-disabled"))return;0===(null===(i=r.current.filteredItems)||void 0===i?void 0:i.length)&&t.setAttribute("data-index","-1");const o=t.getAttribute("data-index");null!==o&&r.current.selectItemAtIndex(o,e),r.hideMenu()}else r.current.externalTrigger?r.current.externalTrigger=!1:r.current.element&&!r.current.externalTrigger&&setTimeout(()=>r.hideMenu())}}var f;class b{constructor(e){f.set(this,void 0),this.tribute=e,this.triggerInfoParser=e.autocompleteMode?new v(this,e.autocompleteSeparator):new T(this,e),this.nullRangeHandler=new x(this,this.tribute.replaceTextSuffix,this.tribute.autocompleteMode),this.textAreaOrInputRangeHandler=new C(this,this.tribute.replaceTextSuffix,this.tribute.autocompleteMode),this.contentEditableRangeHandler=new S(this,this.tribute.replaceTextSuffix,this.tribute.autocompleteMode),this.rangeHandler=this.nullRangeHandler}get element(){return e(this,f,"f")}set element(e){t(this,f,e,"f"),e&&(this.rangeHandler=r(e)?this.textAreaOrInputRangeHandler:this.contentEditableRangeHandler)}getTriggerInfo(e,t,i,n){return this.triggerInfoParser.getTriggerInfo(e,t,i,n)}getTrigger(e){return this.triggerInfoParser.getTrigger(e)}getDocument(){let e;return this.tribute.current.collection&&(e=this.tribute.current.collection.iframe),null==e||null===e.contentWindow?document:e.contentWindow.document}positionMenuAtCaret(e){const t=this.triggerInfoParser.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces);if(void 0===t||void 0===this.element)return;const i=this.rangeHandler.getCoordinate(this.element,t.mentionPosition);i&&this.tribute.menu.positionAtCaret(t,i),e&&this.scrollIntoView()}get menuContainerIsBody(){return this.tribute.menuContainer===document.body||!this.tribute.menuContainer}replaceTriggerText(e,t,i,n,r){const o=this.triggerInfoParser.getTriggerInfo(!0,i,t,this.tribute.allowSpaces),s=this.tribute.current;if(void 0===o||void 0===this.element)return;const l=new CustomEvent("tribute-replaced",{detail:{item:r,instance:s,context:o,event:n}});this.rangeHandler.replaceTriggerText(o,e,this.element),this.element.dispatchEvent(new CustomEvent("input",{bubbles:!0})),this.element.dispatchEvent(l)}getSelectionInfo(){if(void 0!==this.element)return this.rangeHandler.getSelectionInfo(this.element)}getWindowSelection(){var e,t;if(null===(e=this.tribute.collection[0])||void 0===e?void 0:e.iframe){const e=this.tribute.collection[0].iframe.contentWindow;if(e)return e.getSelection()}return(null===(t=this.tribute.collection[0])||void 0===t?void 0:t.shadowRoot)?this.tribute.collection[0].shadowRoot.getSelection():window.getSelection()}getTextPrecedingCurrentSelection(){if(void 0!==this.element)return this.rangeHandler.getTextPrecedingCurrentSelection(this.element)}isMenuOffScreen(e,t){const i=window.innerWidth,n=window.innerHeight,r=document.documentElement,o=(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0),s=(window.pageYOffset||r.scrollTop)-(r.clientTop||0),l="number"==typeof e.top?e.top:"number"==typeof e.bottom?s+n-e.bottom-t.height:void 0,a="number"==typeof e.right?e.right:"number"==typeof e.left?e.left+t.width:void 0,c="number"==typeof e.bottom?e.bottom:"number"==typeof e.top?e.top+t.height:void 0,u="number"==typeof e.left?e.left:"number"==typeof e.right?o+i-e.right-t.width:void 0;return{top:"number"==typeof l?l<Math.floor(s):void 0,right:"number"==typeof a?a>Math.ceil(o+i):void 0,bottom:"number"==typeof c?c>Math.ceil(s+n):void 0,left:"number"==typeof u?u<Math.floor(o):void 0}}scrollIntoView(e){let t;let i=this.tribute.menu.element;if(null===i)return;for(;void 0===t||0===t.height;)if(i instanceof HTMLElement&&(t=i.getBoundingClientRect()),0===(null==t?void 0:t.height)&&(i=i.childNodes[0],null==i||!("getBoundingClientRect"in i)))return;const n=t.top,r=n+t.height;if(n<0)window.scrollTo(0,window.pageYOffset+t.top-20);else if(r>window.innerHeight){let e=window.pageYOffset+t.top-20;e-window.pageYOffset>100&&(e=window.pageYOffset+100);let i=window.pageYOffset-(window.innerHeight-r);i>e&&(i=e),window.scrollTo(0,i)}}}f=new WeakMap;class v{constructor(e,t){this.range=e,this.separator=t}getTrigger(e){return""}getTriggerInfo(e,t,i,n){const r=this.range.getSelectionInfo(),o=this.range.getTextPrecedingCurrentSelection();if(void 0!==r&&void 0!==o)return this._getTriggerInfo(r,o)}_getTriggerInfo(e,t){const i=this.getLastWordInText(t);return{mentionPosition:t.length-(i||"").length,mentionText:i,mentionSelectedElement:e.selected,mentionSelectedPath:e.path,mentionSelectedOffset:e.offset}}getLastWordInText(e){let t;t=null!==this.separator?e.split(this.separator):[e];return t[t.length-1]}}class T{constructor(e,t){this.range=e,this.tribute=t}getTrigger(e){if(Number.isNaN(e)||!e)return;const t=this.range.tribute.triggers().find(t=>(null==t?void 0:t.charCodeAt(0))===e);return void 0!==t?t:void 0}getTriggerInfo(e,t,i,n){const r=this.range.getSelectionInfo(),o=this.range.getTextPrecedingCurrentSelection();if(null==o)return;const s=this._getTrigger(i,o);return s?this._getTriggerInfo(e,t,n,o,s,r):void 0}_getTrigger(e,t){let i,n=-1,r=e;for(const e of this.tribute.collection){const o=e.trigger,s=e.requireLeadingSpace?this.lastIndexWithLeadingSpace(t,o):t.lastIndexOf(o);s>n&&(n=s,i=o,r=e.requireLeadingSpace)}if(void 0!==i&&n>=0&&(0===n||!r||/\s/.test(t.substring(n-1,n))))return{mostRecentTriggerCharPos:n,triggerChar:i,requireLeadingSpace:!!r}}lastIndexWithLeadingSpace(e,t){const i=e.split("").reverse().join("");let n=-1;for(let r=0,o=e.length;r<o;r++){const o=r===e.length-1,s=i[r+1],l=void 0!==s&&/\s/.test(s);let a=!0;for(let e=t.length-1;e>=0;e--)if(t[e]!==i[r-e]){a=!1;break}if(a&&(o||l)){n=e.length-1-r;break}}return n}_getTriggerInfo(e,t,i,n,r,o){let s=n.substring(r.mostRecentTriggerCharPos+r.triggerChar.length,n.length);r.triggerChar=n.substring(r.mostRecentTriggerCharPos,r.mostRecentTriggerCharPos+r.triggerChar.length);const l=s.substring(0,1),a=s.length>0&&(" "===l||" "===l);t&&(s=s.trim());const c=i?/[^\S ]/g:/[\xA0\s]/g;if(this.tribute.hasTrailingSpace=c.test(s),!a&&(e||!c.test(s)))return{mentionPosition:r.mostRecentTriggerCharPos,mentionText:s,mentionSelectedElement:null==o?void 0:o.selected,mentionSelectedPath:null==o?void 0:o.path,mentionSelectedOffset:null==o?void 0:o.offset,mentionTriggerChar:r.triggerChar}}}class w{constructor(e,t,i){this.range=e,this.replaceTextSuffix=t,this.autocompleteMode=i}getFixedCoordinatesRelativeToRect(e){const t={position:"fixed",left:e.left,top:e.top+e.height},i=this.range.tribute.menu.getDimensions(),n=e.top,r=window.innerHeight-(e.top+e.height),o=i.height;null!==o&&r<o&&(n>=o||n>r?(t.top="auto",t.bottom=window.innerHeight-e.top,r<o&&(t.maxHeight=n)):n<o&&(t.maxHeight=r));const s=e.left,l=window.innerWidth-e.left,a=i.width;return null!==a&&l<a&&(s>=a||s>l?(t.left="auto",t.right=window.innerWidth-e.left,l<a&&(t.maxWidth=s)):s<a&&(t.maxWidth=l)),t}}class x extends w{replaceTriggerText(e,t,i){}getSelectionInfo(e){}getTextPrecedingCurrentSelection(e){}getCoordinate(e,t,i){}}class C extends w{getCoordinate(e,t,i){if(!(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement))return;const n=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],r=this.range.getDocument().createElement("div");r.id="input-textarea-caret-position-mirror-div",this.range.getDocument().body.appendChild(r);const o=getComputedStyle(e);r.style.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(r.style.wordWrap="break-word"),r.style.position="absolute",r.style.visibility="hidden";for(const e of n){const t=o.getPropertyValue(e);r.style.setProperty(e,t)}const s=document.createElement("span");s.textContent=e.value.substring(0,t),r.appendChild(s),"INPUT"===e.nodeName&&null!==r.textContent&&(r.textContent=r.textContent.replace(/\s/g," "));const l=this.range.getDocument().createElement("span");l.textContent="&#x200B;",r.appendChild(l);const a=this.range.getDocument().createElement("span");a.textContent=e.value.substring(t),r.appendChild(a);const c=e.getBoundingClientRect();r.style.position="fixed",r.style.left=`${c.left}px`,r.style.top=`${c.top}px`,r.style.width=`${c.width}px`,r.style.height=`${c.height}px`,r.scrollTop=e.scrollTop;const u=l.getBoundingClientRect();return this.range.getDocument().body.removeChild(r),this.getFixedCoordinatesRelativeToRect(u)}replaceTriggerText(e,t,i){var n,r;if(!(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement))return;const o=i,s="string"==typeof this.replaceTextSuffix?this.replaceTextSuffix:" ",l=t+s,a=e.mentionPosition;let c=e.mentionPosition+((null===(n=e.mentionText)||void 0===n?void 0:n.length)||0)+(""===s?1:s.length);this.autocompleteMode||(c+=((null===(r=e.mentionTriggerChar)||void 0===r?void 0:r.length)||0)-1),o.selectionStart=a+l.length,o.value=o.value.substring(0,a)+l+o.value.substring(c,o.value.length),o.selectionEnd=a+l.length}getSelectionInfo(e){return{selected:e}}getTextPrecedingCurrentSelection(e){if(!(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement))return;const t=e,i=t.selectionStart;return t.value&&null!==i&&i>=0?t.value.substring(0,i):void 0}}class S extends w{getCoordinate(e,t,i){const n=this.range.getWindowSelection();if(null===n||null===n.anchorNode)return;const r=this.range.getDocument().createRange();r.setStart(n.anchorNode,t),r.setEnd(n.anchorNode,t),r.collapse(!1);const o=r.getBoundingClientRect();return this.getFixedCoordinatesRelativeToRect(o)}replaceTriggerText(e,t,i){var n,r;let o=t;if(o instanceof HTMLElement);else{o+="string"==typeof this.replaceTextSuffix?this.replaceTextSuffix:" "}let s=e.mentionPosition+((null===(n=e.mentionText)||void 0===n?void 0:n.length)||0);this.autocompleteMode||(s+=(null===(r=e.mentionTriggerChar)||void 0===r?void 0:r.length)||0),this.pasteHtml(o,e.mentionPosition,s)}getSelectionInfo(e){const t=this.getContentEditableSelectedPath();if(t)return{selected:t.selected,path:t.path,offset:t.offset}}getTextPrecedingCurrentSelection(e){const t=this.range.getWindowSelection();if(null===t)return"";const i=t.anchorNode;if(null!=i){const e=i.textContent,t=this.range.getWindowSelection();if(null===t)return;const n=t.getRangeAt(0).startOffset;if(e&&n>=0)return e.substring(0,n)}}pasteHtml(e,t,i){const n=this.range.getWindowSelection(),r=this.range.getDocument().createRange();if(null===n||null===n.anchorNode)return;r.setStart(n.anchorNode,t),r.setEnd(n.anchorNode,i),r.deleteContents();const o=this.range.getDocument().createElement("div");e instanceof HTMLElement?o.appendChild(e):o.innerHTML=e;const s=this.range.getDocument().createDocumentFragment();let l,a;for(;o.firstChild;)l=o.firstChild,a=s.appendChild(l);if(r.insertNode(s),a){const e=r.cloneRange();e.setStartAfter(a),e.collapse(!0),null==n||n.removeAllRanges(),null==n||n.addRange(e)}}getContentEditableSelectedPath(){const e=this.range.getWindowSelection();if(null===e)return;let t=null==e?void 0:e.anchorNode;const i=[];let n;if(t instanceof Node){let r,o=t instanceof HTMLElement&&t.contentEditable;for(;null!==t&&"true"!==o;)r=this.getNodePositionInParent(t),i.push(r),t=t.parentNode,t instanceof HTMLElement&&(o=t.contentEditable);if(i.reverse(),n=e.getRangeAt(0).startOffset,t)return{selected:t,path:i,offset:n}}}getNodePositionInParent(e){if(null===e.parentNode)return 0;for(let t=0;t<e.parentNode.childNodes.length;t++){if(e.parentNode.childNodes[t]===e)return t}}}class y{constructor(e){this.tribute=e}simpleFilter(e,t){return t.filter(t=>this.test(e,t))}test(e,t){return null!==this.match(e,t)}match(e,t,i){const n=i||{},r=n.pre||"",o=n.post||"",s=n.caseSensitive&&t||t.toLowerCase();if(n.skip)return{rendered:t,score:0};const l=n.caseSensitive&&e||e.toLowerCase(),a=this.traverse(s,l,0,0,[]);return a?{rendered:this.render(t,a.cache,r,o),score:a.score}:null}traverse(e,t,i,n,r){const o=this.tribute.autocompleteSeparator?t.split(this.tribute.autocompleteSeparator).splice(-1)[0]:t;if(void 0===o)return;if(o.length===n)return{score:this.calculateScore(r),cache:r.slice()};if(e.length===i||o.length-n>e.length-i)return;const s=o[n];if(!s)return;let l,a,c=e.indexOf(s,i);for(;c>-1;){if(r.push(c),a=this.traverse(e,t,c+1,n+1,r),r.pop(),!a)return l;(!l||l.score<a.score)&&(l=a),c=e.indexOf(s,c+1)}return l}calculateScore(e){let t=0,i=1;return e.forEach((n,r)=>{if(r>0){const t=e[r-1];void 0!==t&&t+1===n?i+=1:i=1}t+=i}),t}render(e,t,i,n){let r=e.substring(0,t[0]);return t.forEach((o,s)=>{r+=i+e[o]+n+e.substring(o+1,t[s+1]?t[s+1]:e.length)}),r}filter(e,t,i){const n=i||{};return t.reduce((t,i,r,o)=>{let s=i;n.extract&&(s=n.extract(i),s||(s=""));const l="string"==typeof s?this.match(e,s,n):null;return null!=l&&(t[t.length]={string:l.rendered,score:l.score,index:r,original:i}),t},[]).sort((e,t)=>{const i=t.score-e.score;return i||e.index-t.index})}}const M={values:null,loadingItemTemplate:null,iframe:null,shadowRoot:null,selectClass:"highlight",containerClass:"tribute-container",itemClass:"",trigger:"@",autocompleteMode:!1,autocompleteSeparator:/\s+/,selectTemplate:null,menuItemTemplate:null,lookup:"key",fillAttr:"value",collection:null,menuContainer:null,noMatchTemplate:null,requireLeadingSpace:!0,allowSpaces:!1,replaceTextSuffix:null,positionMenu:!0,spaceSelectsMatch:!1,searchOpts:{},menuItemLimit:null,menuShowMinLength:0,closeOnScroll:!1,maxDisplayItems:null,isBlocked:!1};function E(e,t){var i,r,o;if(!(null==e?void 0:e.collection))throw new Error("current Collection is undefined");const s=(l=e.collection.fillAttr,(a=null==t?void 0:t.original)&&l in a&&null!==(r=null===(i=null==t?void 0:t.original)||void 0===i?void 0:i[e.collection.fillAttr])&&void 0!==r?r:e.mentionText);var l,a;const c=null!==(o=e.collection.trigger)&&void 0!==o?o:"";return e.element&&n(e.element)?`<span class="tribute-mention">${c}${s}</span>`:`${c}${s}`}function I(e){return e.string}return class{constructor(e){const t=function(e){const t=Object.entries(e).filter(([,e])=>void 0!==e);return Object.assign({},...t.map(([e,t])=>({[e]:t})))}(e),i=Object.assign(Object.assign({},M),t);this._isActive=!1,this.autocompleteMode=i.autocompleteMode,this.autocompleteSeparator=i.autocompleteSeparator,this.current=new a(this),this.isActive=!1,this.menuContainer=i.menuContainer,this.allowSpaces=i.allowSpaces,this.replaceTextSuffix=i.replaceTextSuffix,this.positionMenu=i.positionMenu,this.hasTrailingSpace=!1,this.spaceSelectsMatch=i.spaceSelectsMatch,this.closeOnScroll=i.closeOnScroll,this.menu=new m(this),this.autocompleteMode&&(i.trigger="",i.allowSpaces=!1),this.collection=this.buildCollection(i),this.range=new b(this),this.events=new u(this),this.menuEvents=new p(this),this.search=new y(this)}get isActive(){return this._isActive}set isActive(e){if(this._isActive!==e&&(this._isActive=e,this.current.element)){const t=new CustomEvent(`tribute-active-${e}`);this.current.element.dispatchEvent(t)}}triggers(){return this.collection.map(e=>e.trigger)}attach(e){const t=o(e)?e.get():e;if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if(t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t))for(const e of t)e instanceof HTMLElement&&this._attach(e);else this._attach(t)}_attach(e){e.hasAttribute("data-tribute")&&console.warn(`Tribute was already bound to ${e.nodeName}`),this.ensureEditable(e),this.events.bind(e),e.setAttribute("data-tribute","true")}ensureEditable(e){if(n(e)){if("string"!=typeof e.contentEditable)throw new Error(`[Tribute] Cannot bind to ${e.nodeName}, not contentEditable`);e.contentEditable="true"}}showMenuForCollection(e,t){const i=t||0,n=this.collection[i];this.current.showMenuForCollection(e,n),this.showMenuFor(e)}showMenuFor(e,t){if(void 0!==this.current.collection&&!this.current.isMaximumItemsAdded(this.current.collection,e)){if(this.currentMentionTextSnapshot=this.current.mentionText,!this.menu.element){const t=this.menu.create(this.range.getDocument(),this.current.collection.containerClass);e.tributeMenu=t,this.menuEvents.bind(t)}this.isActive=!0,this.menu.activate(),this.current.process(t)}}hideMenu(){this.menu.isActive&&(this.isActive=!1,this.menu.deactivate(),this.current=new a(this))}_append(e,t,i){if("function"==typeof e.values)throw new Error("Unable to append to values, as it is a function.");i||null===e.values?e.values=t:e.values=e.values.concat(t)}append(e,t,i){const n=Number.parseInt(e,10);if("number"!=typeof n)throw new Error("please provide an index for the collection to update.");const r=this.collection[n];void 0!==r&&this._append(r,t,!!i)}appendCurrent(e,t){if(!this.isActive||void 0===this.current.collection)throw new Error("No active state. Please use append instead and pass an index.");this._append(this.current.collection,e,t)}detach(e){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");const t=o(e)?e.get():e;if(t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t))for(const e of t)e instanceof HTMLElement&&this._detach(e);else this._detach(t)}_detach(e){this.events.unbind(e),e.tributeMenu&&this.menuEvents.unbind(e.tributeMenu),setTimeout(()=>{e.removeAttribute("data-tribute"),this.isActive=!1,e.tributeMenu&&e.tributeMenu.remove()})}buildCollection(e){const{values:t,collection:i,menuItemTemplate:n,noMatchTemplate:r,selectTemplate:o}=e,s=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(e,["values","collection","menuItemTemplate","noMatchTemplate","selectTemplate"]);if(t)return[Object.assign(Object.assign({},s),{values:t,selectTemplate:o?o.bind(this):e=>E(this.current,e),menuItemTemplate:(n||I).bind(this),noMatchTemplate:this.createNoMatchTemplate(r,r)})];if(i)return this.autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),i.map(e=>Object.assign(Object.assign(Object.assign({},s),e),{selectTemplate:e.selectTemplate?e.selectTemplate.bind(this):e=>E(this.current,e),menuItemTemplate:(e.menuItemTemplate||I).bind(this),noMatchTemplate:this.createNoMatchTemplate(e.noMatchTemplate,r)}));throw new Error("[Tribute] No collection specified.")}createNoMatchTemplate(e,t){return"string"==typeof e?""===e.trim()?null:e:"function"==typeof e?e.bind(this):null!=t?t:(()=>"<li>No Match Found!</li>").bind(this)}static isContentEditable(e){return n(e)}}});
